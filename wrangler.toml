name = "stock-analyzer-api"
main = "src/index.ts"
compatibility_date = "2024-10-01"
compatibility_flags = ["nodejs_compat"]

[vars]
ENVIRONMENT = "production"
# Ticker selection strategy: most_active, gainers, losers, mixed, or static
# Strategies use free Yahoo Finance endpoints (no API keys required)
TICKER_STRATEGY = "most_active"

# KV namespace for stock data caching (optional but recommended)
# Create with: npx wrangler kv:namespace create "STOCK_CACHE"
[[kv_namespaces]]
binding = "STOCK_CACHE"
id = "9925258550724f37bf163ad2a1f6569f"
preview_id = "8665e2b2fad449f89f3bd8d986e11892"

# Rate limiting with Durable Objects
[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiter"

# Durable Objects migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = ["RateLimiter"]

# D1 Database for signal history
[[d1_databases]]
binding = "DB"
database_name = "stockpulse-signals"
database_id = "fe8ef8f0-01ba-4e59-b328-7ebac23d143f"

# Cron trigger - daily at 4pm ET (21:00 UTC) on weekdays
[triggers]
crons = ["0 21 * * 1-5"]

# For production
# [env.production]
# route = "api.yourdomain.com/*"
